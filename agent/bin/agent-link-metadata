#!/usr/bin/env bash

# Create symbolic links to metadata such as memory, which is managed outside the project.
#
# Use cases:
# - Manage metadata with git separately from the project.
# - Share metadata from the main worktree.

set -eu -o pipefail

usage="Usage: ${BASH_SOURCE[0]} METADATA_SRC METADATA_DIR"
metadata_src="$(cd "${1:?"$usage"}" && pwd)"
metadata_dir="${2:?"$usage"}"

# setup source
mkdir -pv "$metadata_src/memory"
mkdir -pv "$metadata_src/sandbox"
touch "$metadata_src/instructions.md"

# setup metadata dir
mkdir -pv "$metadata_dir"
ln -sfv "$metadata_src/memory" "$metadata_dir/memory"
ln -sfv "$metadata_src/sandbox" "$metadata_dir/sandbox"
ln -sfv "$metadata_src/instructions.md" "$metadata_dir/instructions.md"
ln -sfv "$metadata_src/config.json" "$metadata_dir/config.json"
echo "creating $metadata_dir/.gitignore"
echo "*" > "$metadata_dir/.gitignore"
